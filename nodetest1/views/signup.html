<!DOCTYPE html>
<html>
<!--Head Info-->
  <head>
    <meta charset='utf-8' />
    <link rel='stylesheet' href='lib/cupertino/jquery-ui.min.css' />
    <link rel='stylesheet' href='fullcalendar/fullcalendar.css' />
    <link href='fullcalendar/fullcalendar.print.css' rel='stylesheet' media='print' />
    <script src='lib/jquery.min.js'></script>
    <script src='lib/moment.min.js'></script>
    <script src='fullcalendar/fullcalendar.js'></script>
    <script src='fullcalendar/fullcalendar.min.js'></script>
    <script src='lib/jquery-ui.custom.min.js'></script>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css">
    <title>Tutor Me - Registration Page</title>
    <link rel="icon" href="images/favicon.png"> <!-- favicon not yet made -->

    <script>

    $(document).ready(function() {

        /* initialize the external events
        -----------------------------------------------------------------*/
        $('#external-events .fc-event').each(function() {

            // store data so the calendar knows to render an event upon drop
            $(this).data('event', {
                title: $.trim($(this).text()), // use the element's text as the event title
                stick: true // maintain when user navigates (see docs on the renderEvent method)
            });

            // make the event draggable using jQuery UI
            $(this).draggable({
                zIndex: 999,
                revert: true,      // will cause the event to go back to its
                revertDuration: 0  //  original position after the drag
            });

        });

        /* initialize the calendar
        -----------------------------------------------------------------*/

		$('#calendar').fullCalendar({
            theme: true,
			header: {
			},
            defaultView: 'agendaWeek',
			editable: true,
            droppable: true, // this allows things to be dropped onto the calendar
			drop: function() {
			},
			eventLimit: true, // allow "more" link when too many events
			events: [],


            eventClick: function(calEvent, jsEvent, view) {
                //Change the border color of the event to red
                $(this).css('border-color', 'red');
                if(confirm("Do you want to delete this event?")){
                    //remove event from calendar
                    $('#calendar').fullCalendar('removeEvents',this._id);
                } else {
                    //if event is not deleted, return border to previous color
                    $(this).css('border-color', '#3a87ad');
                }
            }

		});

        //$('#calendar').fullCalendar('clientEvents');

	});

    </script>

    <script>
    //Converting form to JSON
    //Source: http://jsfiddle.net/sxGtM/3/ - http://stackoverflow.com/questions/1184624/convert-form-data-to-javascript-object-with-jquery
    $.fn.serializeObject = function()
    {
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
    };

    $(function() {
        $('form').submit(function() {
            var TWO_HOURS = 7200;
            var myEvents = $('#calendar').fullCalendar('clientEvents');

            var nonCircularEvents = [];
            for (var i = 0; i < myEvents.length; i++)
            {
                var newEvent = {};
                newEvent.start = myEvents[i].start;
                if(myEvents[i].end == null){
                    newEvent.end = moment(myEvents[i].start).add(2, 'hours');
                }
                else{
                        newEvent.end = myEvents[i].end;
                }
                nonCircularEvents.push(newEvent);
            }

            myJSONObj = $('form').serializeObject();
            myJSONObj.events = nonCircularEvents;

            //TODO: SUBMIT THE FORM INSTEAD OF ALERTING
            alert(JSON.stringify(myJSONObj));

            // Sending and receiving data in JSON format using POST method
            xhr = new XMLHttpRequest();
            var url = "http://127.0.0.1:3000/registration?data=" + encodeURIComponent(JSON.stringify(myJSONObj));
            xhr.open("GET", url, true);
            xhr.setRequestHeader("Content-type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var serverResponse = xhr.responseText;
                    //TODO: Check according to the response if the
                    //data was successfully saved to the DB
                }
            }
            xhr.send();

            return false;
        });
    });

    //Unused function - experimenting with JS and MongoDB here
    /*
    function sendForm(inputJSON)
    {
        var myEvents = getEvents();
        var MongoClient = require('mongodb').MongoClient;

        alert("Will connect");
        //Mongo
        // Connect to the db
        MongoClient.connect("mongodb://localhost:27017/newDB", function(err, db) {
          if(err) { return console.dir(err); }
          else { alert("connected"); }

          var collection = db.collection('test');
          var doc1 = {'hello':'doc1'};
          var doc2 = {'hello':'doc2'};
          var lotsOfDocs = [{'hello':'doc3'}, {'hello':'doc4'}];

          collection.insert(doc1);

          collection.insert(doc2, {w:1}, function(err, result) {});

          collection.insert(lotsOfDocs, {w:1}, function(err, result) {});

        });
    }
    */
    </script>

  </head>

<!-- Header bar -->
<div class="header">
    <a href="/"><img  id="logo" src="images/logo.png" alt="Logo"></a></div>
<div class="header_text">
    <h1>
        Welcome to Tutor Me!
    </h1>
</div>
<div class="content">
    <h1> Sign up to TutorMe </h1>

    <form id='register'>
        <fieldset>
            <legend>Register</legend>
                <div id='register_labels'>
                    <label for='name'>Name*:</label>
                    <br/>
                    <label for='email' >Email Address*:</label>
                    <br/>
                    <label for='username' >UserName*:</label>
                    <br/>
                    <label for='password' >Password*:</label>
                    <br/>
                    <label for='type_of_user' >Do you want to Tutor?</label>
                    <br/>
                    <label for='profile_pic' >Profile Picture:</label>
                    <br/>
                </div>
                <div id='register_inputs'>
                    <input type='text' name='name' id='name' maxlength="50" size="25" />
                    <br/>
                    <input type='text' name='email' id='email' maxlength="50" size="25"  />
                    <br/>
                    <input type='text' name='username' id='username' maxlength="20" size="25" />
                    <br/>
                    <input type='password' name='password' id='password' maxlength="25" size="25" />
                    <br/>
                    <input type='checkbox' name='type_of_user' id='type_of_user' value="Yes"/>
                    <br/>
                    <input type='file' name='profile_pic' id='profile_pic' accept="image/*" capture/>
                    <br/>
                </div>
                <fieldset display='none' class="subjects">
                    <legend>Subjects I want to teach</legend>
                        <table>
                        <tr>
                            <td><input type='checkbox' name='math' id='math' value="Math"/>
                            <label for="math">Math</label></td>
                            <td><input type='checkbox' name='biology' id='biology' value="Biology"/>
                            <label for="biology">Biology</label></td>
                            <td><input type='checkbox' name='chemistry' id='chemistry' value="Chemistry"/>
                            <label for="chemistry">Chemistry</label></td>
                        </tr><tr>
                            <td><input type='checkbox' name='physics' id='physics' value="Physics"/>
                            <label for="physics">Physics</label></td>
                            <td><input type='checkbox' name='geography' id='geography' value="Geography"/>
                            <label for="geography">Geography </label></td>
                            <td><input type='checkbox' name='english' id='english' value="English"/>
                            <label for="english">English</label></td>
                        <tr></tr>
                            <td><input type='checkbox' name='history' id='history' value="History"/>
                            <label for="history">History</label></td>
                        </tr>
                        </table>
                </fieldset>
                <br/>
                <br/>

                <div id='wrap'>
                    <div id='external-events'>
            			<h4>Drag the Slots to the periods of the week you usually have available:</h4>
            			<div class='fc-event'>Available Slot</div>
            			<div class='fc-event'>Available Slot</div>
            			<div class='fc-event'>Available Slot</div>
            			<div class='fc-event'>Available Slot</div>
            			<div class='fc-event'>Available Slot</div>
                        <div class='fc-event'>Available Slot</div>
            			<div class='fc-event'>Available Slot</div>
                        <div class='fc-event'>Available Slot</div>
            			<div class='fc-event'>Available Slot</div>
                        <div class='fc-event'>Available Slot</div>
            			<div class='fc-event'>Available Slot</div>
                        <div class='fc-event'>Available Slot</div>
            			<div class='fc-event'>Available Slot</div>
            		</div>
                    <div id='calendar'></div>
                    <div style='clear:both'></div>
                </div>
                <br/>
                <br/>
                <div class="main_button_holder"><input class=main_button type='submit' name='Submit' value='Register to TutorMe'/></div>
        </fieldset>
    </form>
</div>

</html>
